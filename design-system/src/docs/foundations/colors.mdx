import { Meta, Unstyled } from "@storybook/addon-docs/blocks";
import { CopyButton } from "./copy-button";
import tokens from "@digital-go-jp/design-tokens";
import "./foundations.css";
import "../../components/table/scroll-shadow";

<Meta title="Foundations/カラー" />

export const generateCSSVarName = (path) => {
  return `--color-${path.slice(1).map(part => 
    part.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase()
  ).join('-')}`;
};

export const processColorTokens = (colorTokens) => {
  const categories = {
    primitive: {
      title: "プリミティブカラー",
      groups: {}
    },
    neutral: {
      title: "ニュートラルカラー", 
      groups: {}
    },
    semantic: {
      title: "セマンティックカラー",
      groups: {}
    }
  };

  // プリミティブカラーの処理
  Object.entries(colorTokens.Primitive).forEach(([colorName, colorShades]) => {
    const colors = Object.entries(colorShades).map(([shade, token]) => ({
      level: shade,
      hex: token.$value,
      cssVar: generateCSSVarName(token.path)
    }));
    categories.primitive.groups[colorName] = {
      name: colorName,
      colors
    };
  });

  // ニュートラルカラーの処理
  Object.entries(colorTokens.Neutral).forEach(([colorName, colorData]) => {
    if (colorName === 'White' || colorName === 'Black') {
      // White/Blackは単体カラー
      if (!categories.neutral.groups.Special) {
        categories.neutral.groups.Special = {
          name: "Special",
          colors: []
        };
      }
      categories.neutral.groups.Special.colors.push({
        level: colorName,
        hex: colorData.$value,
        cssVar: generateCSSVarName(colorData.path)
      });
    } else {
      // SolidGray/OpacityGrayは階調カラー
      const colors = Object.entries(colorData).map(([shade, token]) => ({
        level: shade,
        hex: token.$value,
        cssVar: generateCSSVarName(token.path)
      }));
      categories.neutral.groups[colorName] = {
        name: colorName.replace(/([A-Z])/g, ' $1').trim(),
        colors
      };
    }
  });

  // セマンティックカラーの処理
  Object.entries(colorTokens.Semantic).forEach(([category, categoryData]) => {
    if (category === 'Warning') {
      // Warning配下にYellow/Orangeがある
      Object.entries(categoryData).forEach(([subCategory, subCategoryData]) => {
        const colors = Object.entries(subCategoryData).map(([level, token]) => ({
          level: level,
          hex: token.$value,
          cssVar: generateCSSVarName(token.path)
        }));
        categories.semantic.groups[`${category} ${subCategory}`] = {
          name: `${category} ${subCategory}`,
          colors
        };
      });
    } else {
      // Success/Errorは直接レベルを持つ
      const colors = Object.entries(categoryData).map(([level, token]) => ({
        level: level,
        hex: token.$value,
        cssVar: generateCSSVarName(token.path)
      }));
      categories.semantic.groups[category] = {
        name: category,
        colors
      };
    }
  });

  return categories;
};

export const colorData = processColorTokens(tokens.Color);

<Unstyled>
<div className="prose">

# カラー

デジタル庁デザインシステムで定義されているカラーパレットです。

{Object.entries(colorData).map(([categoryKey, category]) => (
  <div key={categoryKey} className="color-section">
    <h2>{category.title}</h2>
    {Object.entries(category.groups).map(([groupKey, group]) => (
      <div key={groupKey} className="color-group">
        <h3 id={`group-${groupKey}-name`}>{group.name}</h3>
        <dads-scroll-shadow style={{"--scroll-shadow-padding": "calc(16 / 16 * 1rem)"}}>
          <div className="color-grid">
            {group.colors.map((color, index) => (
              <div key={index} className="color-card">
                <div className="color-info">
                  <h4 id={`color-${color.level}-name`} className="color-level">{color.level}</h4>
                </div>
                <div 
                  className="color-chip" 
                  style={{ backgroundColor: `var(${color.cssVar})` }}
                />
                <pre className="color-css"><code>var({color.cssVar})</code></pre>
                <CopyButton text={`var(${color.cssVar})`} label="CSS変数をコピー" ariaDescribedby={`group-${groupKey}-name color-${color.level}-name`} />
                <pre className="color-css"><code>{color.hex}</code></pre>
                <CopyButton text={color.hex} label="色コードをコピー" ariaDescribedby={`group-${groupKey}-name color-${color.level}-name`} />
              </div>
            ))}
          </div>
        </dads-scroll-shadow>
      </div>
    ))}
  </div>
))}

</div>
</Unstyled>
